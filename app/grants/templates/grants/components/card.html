  {% comment %}
  Copyright (C) 2020 Gitcoin Core

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published
  by the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program. If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}
{% load i18n static humanize grants_extra %}
<grant-card inline-template :grant="grant" :cred="credentials" :view="view" :short="shortView"
            :contributions='contributions' :show_contributions="show_contributions" :collection="activeCollection"
            :has_collections="collections.length"
            v-on:collection:remove='removeCollection'>
  <template>
    <div v-if="view == 'list'">
      <div class="row justify-content-between align-items-center border flex-nowrap">
        <!-- Grant image -->
        <img class="col-auto grant-item__img" :src="grant.logo_url">

        <!-- Grant title, creator, and match info -->
        <div class="col">
          <div class="row justify-content-start align-items-center">
            <!-- Grant title and verification icon -->
            <h5 class="col-12 gc-font-base mt-3">
              <a class="text-decoration-none text-black font-weight-bold" :href="grant.details_url" target="_blank">
                [[ grant.title | truncate(60) ]]
              </a>
              <button v-if="grant.verified" class="col-auto btn btn-sm animate-verify p-0" id="tooltip-verify">
                <b-tooltip target="tooltip-verify" triggers="hover click" variant="light" placement="bottom">
                  <p class="h6 my-2 text-left">Verified Ownership <img width="18" src="{% static "v2/images/badge-verify.svg" %}"></p>
                  <p class="text-left">Grant owner has verified ownership of their twitter account.</p>
                  <a href="#">Learn more.</a>
                </b-tooltip>
                <img width="13" src="{% static 'v2/images/badge-verify.svg' %}" alt="">
              </button>
            </h5>

            <!-- Grant creator -->
            <div class="col-12 text-muted small">
              By
              <a :href="grant.admin_profile.url" :data-usercard="grant.admin_profile.handle" target="_blank" rel="noopener noreferrer">
                  [[ grant.admin_profile.handle]]
              </a>
            </div>

            <!-- Round number and supported platforms -->
            <div class="col-12 my-3">
              <div>Grants Round [[grant.clr_round_num]]</div>
              <div>
                <!-- TODO: add chain logo images after Round 9 -->
              </div>
            </div>

            <!-- Amount raised and estimated match amount -->
            <div v-if="grant.clr_round_num || true" class="col-12">
              <span class="text-muted">
                <span class="h5 gc-font-base text-black">$[[ grant.amount_received_in_round || 0 | round | formatNumber ]]</span>
                from [[ grant.positive_round_contributor_count ]] contributors
                <span class="ml-3">
                  Est. Matching <span class="text-success">+$[[ get_clr_prediction(0, 1) || 0  | round | formatNumber ]]</span>
                </span>
              </span>
            </div>
          </div>
        </div>

        <!-- Quick view and add to cart buttons -->
        <div class="col-auto mx-3 mt-4 pb-4">
          <div class="row justify-content-between pb-1">
            <button @click="quickView($event)" class="btn btn-outline-primary col-auto mr-2">
              <i class="far fa-eye text-center"></i>
            </button>
            <button v-if="grant.isInCart" @click.prevent="removeFromCart(grant)" class="btn btn-outline-danger col">
              - Remove from Cart
            </button>
            <button v-else @click.prevent="addToCart(grant)" class="btn btn-primary col">
              + Add to Cart
            </button>
          </div>
          <button v-if="collection && isCurator" @click.prevent="$emit('collection:remove', {collection: collection, grant: grant})" class="btn btn-block btn-outline-danger font-body mt-1 mr-1">
            - Remove from collection
          </button>
        </div>

{% comment %} 
        <div>
          <div>
            <p class="text-muted font-smaller-5 mb-0" style="height:2rem;"  data-toggle="tooltip" data-placement="top" title="The last time the grant admin updated the grant." >
              <i style="width: 14px;" class="fas fa-clock mt-2 mb-0 text-center"></i>
              Last Update: [[ grant.last_update ?  grant.last_update_natural : `Long Ago` ]]
              <template v-if="cred.is_staff">
                <span class="ml-3" >
                  <i class="fa fa-lock" aria-hidden="true"></i> SybilScore ™️: [[ grant.sybil_score ]]
                  <span class="mx-2">|</span> RiskScore ™️: [[ grant.weighted_risk_score ]]
                </span>
              </template>
            </p>
            <div class="grant-item__owner">
              <div class="d-flex">
                <a :href="grant.admin_profile.url"  :data-usercard="grant.admin_profile.handle" target="_blank" rel="noopener noreferrer">
                  <div class="d-flex align-center">
                    <div class="grant-item__owner-image ml-2 position-relative" style="top: -4px;">
                      <img :src="grant.admin_profile.avatar_url || 'https://c.gitcoin.co/avatars/57e79c0ae763bb27095f6b265a1a8bf3/thelostone-mc.svg'">
                    </div>
                    <div class="grant-item__owner-handle font-smaller-3">
                      <span class="ml-2">
                        [[ grant.admin_profile.handle || 'anonymous' ]]
                      </span>
                    </div>
                  </div>
                </a>
              </div>
              <div class="d-flex match ml-3">
                <div class="match__round--inline mr-3">
                  <template v-if="grant.clr_round_num">
                    <span class="font-subheader font-weight-bold amount pt-1 mb-2">
                      [[ get_clr_prediction(0, 1) || 0  | round | formatNumber ]]
                      USD
                    </span>
                    <span class="amount mb-2 font-smaller-3">
                      CLR Match
                    </span>
                  </template>
                  <template v-else>
                  </template>
                </div>
                <div v-if="grant.clr_round_num">
                  <span class="font-subheader font-weight-bold amount pt-1 mb-2">
                    [[ grant.amount_received_in_round || 0 | round | formatNumber ]]
                    USD
                  </span>
                  <span class="amount mb-2 font-smaller-3">
                    raised from
                  </span>
                  <span class="amount mb-2 font-smaller-3 font-weight-semibold">
                  [[ grant.positive_round_contributor_count ]] contributors
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div> {% endcomment %}
      </div>
    </div>

    <div v-else class="grant-item">
      <!-- Grant image -->
      <img class="img-fluid" :src="grant.logo_url">
      
      <!-- Content container -->
      <div class="container">
        <!-- Grant title and verification icon -->
        <h5 class="gc-font-base row justify-content-start align-items-center mt-3">
          <a class="col-auto text-decoration-none text-black font-weight-bold" :href="grant.details_url" target="_blank">
            [[ grant.title | truncate(60) ]]
          </a>
          <button v-if="grant.verified" class="col-auto btn btn-sm animate-verify p-0" id="tooltip-verify">
            <b-tooltip target="tooltip-verify" triggers="hover click" variant="light" placement="bottom">
              <p class="h6 my-2 text-left">Verified Ownership <img width="18" src="{% static "v2/images/badge-verify.svg" %}"></p>
              <p class="text-left">Grant owner has verified ownership of their twitter account.</p>
              <a href="#">Learn more.</a>
            </b-tooltip>
            <img width="13" src="{% static 'v2/images/badge-verify.svg' %}" alt="">
          </button>
        </h5>

        <!-- Grant creator -->
        <div class="text-muted small">
          By
          <a :href="grant.admin_profile.url" :data-usercard="grant.admin_profile.handle" target="_blank" rel="noopener noreferrer">
              [[ grant.admin_profile.handle]]
          </a>
        </div>

        <!-- Grant description -->
        <p class="text-muted mt-3">[[ grant.description | truncate(145) ]]</p>
        <hr>

        <!-- Round number and supported platforms -->
        <div class="row justify-content-between align-items-center text-muted mb-2">
          <div class="col-auto">Grants Round [[grant.clr_round_num]]</div>
          <div class="col-auto">
            <!-- TODO: add chain logo images after Round 9 -->
          </div>
        </div>

        <!-- Amount raised and estimated match amount -->
        <div v-if="grant.clr_round_num || true" class="">
          <h5 class="gc-font-base">$[[ grant.amount_received_in_round || 0 | round | formatNumber ]]</h5>
          <p class="text-muted">raised from [[ grant.positive_round_contributor_count ]] contributors</p>
        </div>
        <div class="text-muted">
          Est. Matching <span class="text-success">+$[[ get_clr_prediction(0, 1) || 0  | round | formatNumber ]]</span>
        </div>

        <!-- Quick view and add to cart buttons -->
        <div class="mx-3 mt-4 pb-4">
          <div class="row justify-content-between pb-1">
            <button @click="quickView($event)" class="btn btn-outline-primary col-auto mr-2">
              <i class="far fa-eye text-center"></i>
            </button>
            <button v-if="grant.isInCart" @click.prevent="removeFromCart(grant)" class="btn btn-outline-danger col">
              - Remove from Cart
            </button>
            <button v-else @click.prevent="addToCart(grant)" class="btn btn-primary col">
              + Add to Cart
            </button>
          </div>
          <button v-if="collection && isCurator" @click.prevent="$emit('collection:remove', {collection: collection, grant: grant})" class="btn btn-block btn-outline-danger font-body mt-1 mr-1">
            - Remove from collection
          </button>
        </div>

      </div>


      
      <div class="grant-item__content px-3">
        
        <p class="grant-item__pitch font-caption mb-0" style="height:2rem;"  data-toggle="tooltip" data-placement="top" title="The last time the grant admin updated the grant." >
          <span class="font-smaller-5">
            <i style="width: 14px;" class="fas fa-clock mt-2 mb-0 text-center"></i>
            Last Update: [[ grant.last_update ?  grant.last_update_natural : `Long Ago` ]]
          </span>
        </p>
        <template v-if="cred.is_staff">
          <hr class="my-2">
          <p class="font-caption font-weight-semibold">
            <i class="fa fa-lock mr-2" aria-hidden="true"></i>
            SybilScore ™️: [[ grant.sybil_score ]]
            <span class="mx-2">|</span>
            RiskScore ™️: [[ grant.weighted_risk_score ]]
          </p>
        </template>

        
      </div>
      <div class="grant-item__footer">
          <div class="clr mb-3">
            <div class="match__round pb-1 pt-2 mb-2">
              <h2 class="title col-12 font-caption g-bold" v-if="grant.clr_round_num && grant.is_clr_eligible">
                <span class="text-capitalize">[[grant.clr_round_num]]</span>
                CLR MATCH ROUND
              </h2>
              <h2 class="title col-12 font-caption g-bold" v-else>
                NOT IN AN ACTIVE CLR ROUND
              </h2>
            </div>
            <div class="col-6 float-right px-0" v-if="grant.clr_round_num">
              <h2 class="font-title font-weight-bold amount pt-1 mb-2">
                [[ grant.amount_received_in_round || 0 | round | formatNumber ]]
                USD
              </h2>
              <p class="amount mb-2 font-caption font-weight-semibold">
                raised from [[ grant.positive_round_contributor_count ]] contributors
              </p>
            </div>
            <div class="col-6" v-if="grant.clr_round_num">

              <template v-if="grant.is_clr_eligible">
                <h2 class="font-title font-weight-bold amount pt-1 mb-2">
                  [[ get_clr_prediction(0, 1) || 0  | round | formatNumber ]]
                  USD
                </h2>
                <p class="amount mb-2 font-caption font-weight-semibold">
                  Estimated CLR Match
                </p>
              </template>
              <template v-else>
                <h2 class="font-title font-weight-bold amount pt-1 mb-2">
                  [[ grant.amount_received || 0 | round | formatNumber ]]
                  USD
                </h2>
                <p class="amount mb-2 font-caption font-weight-semibold">All Time Funding</p>
              </template>
            </div>
          </div>

          <div class="col-12 pb-3" v-if="grant.is_clr_eligible && grant.is_clr_active && grant.clr_round_num">
            {% include 'grants/components/clr_estimate.html' %}
          </div>



          <div class="clr mb-3" v-if="show_contributions">
            <div :class="`match__round pb-1 pt-2 ${ (index + 1) % 2 === 0  ? 'no-bg' : ''}`" v-for="(contribution, index) in getContributions(grant.id)">
              <p class="col-12 amount mb-2 font-caption font-weight-semibold"> [[ index + 1 ]]. Contributed
                <span class="font-weight-bold">[[ contribution.amount_per_period ]] [[ contribution.token_symbol ]]</span> at [[ contribution.created_on ]].
              </p>
            </div>
          </div>
    </div>
  </template>
</grant-card>
